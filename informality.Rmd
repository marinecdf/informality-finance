---
title: "Informality and Financial Inclusion in Developing Economies"
author: "Marine"
date: "9/27/2018"
output: github_document
always_allow_html: yes





---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Loading Packages: 

```{r}
# install.packages("pacman")
library(pacman)
pacman::p_load(foreign, readstata13, tidyverse,
               ggthemes, kableExtra, scales, stats,
               GGally, mctest)
```

# Loading the World Bank Enterprise Survey Data for 13 countries:

```{r}
madaga_informal <- foreign::read.dta("Madagascar-2009-Informal-full data-.dta")
ivory_informal <- readstata13::read.dta13("Côte d'Ivoire-2009-Informal-full data-.dta", generate.factors = T)
burkina_informal <- foreign::read.dta("Burkina Faso-2009-Informal-full data-.dta")
mauritius_informal <- foreign::read.dta("Mauritius-2009-Informal-full data-.dta")
capeverde_informal <- foreign::read.dta("Cape Verde-2009-Informal-full data-.dta")
mali_informal <- foreign::read.dta("Mali-2010-Informal-full data-.dta")
botswana_informal <- foreign::read.dta("Botswana-2010-Informal-full data-.dta")
angola_informal <- foreign::read.dta("Angola-2010-Informal-full data-.dta")
rwanda_informal <- foreign::read.dta("Rwandainformal-2011 data-.dta")
nepal_informal <- foreign::read.dta("Nepal-2009-Informal-fulldata-.dta")
argentina_informal <- foreign::read.dta("Argentina-2010-Informal-fulldata-.dta")
peru_informal <- foreign::read.dta("Peru-2010-Informal-fulldata-.dta")
myanmar_informal <- foreign::read.dta("Myanmar_Informal-2014-fulldata.dta")

```

# Subsetting the Data: 

```{r echo=FALSE}
madaga_informal <- madaga_informal %>% 
  select(a3a, a5, b1, b3, afb4a, b6, b8, b11, b12, d4, d13, l1a,
         l1b, k1, k3, k4a, k4b,  k4c, k4d, k4e, k4f, k4g, k5, k6,
         k9, k10, k11, k12, k13, k16, k18, k19, k30, r6a, r6b, 
         r6c, r6d, r6e, r6f, r7a, r11a, r11b, r11c, r11d, r11e, 
         r11f, r11g, r11h, r11i, r12a, m1a)
madaga_informal$country <- "Madagascar"
  
ivory_informal <- ivory_informal %>% 
  select(b1, b3, afb4a, a5, b6, b8, b11, b12, d4, l1a, l1b, k1, k3,
         k4a, k4b, k4c, k4d, k4e, k4f, k4g, k5, k6, k9, k10,
         k11, k12, k13, k16, k18, k19, k30, r6a, r6b, r6c,
         r6d, r6e, r6f, r7a, r11a, r11b, r11c, r11d, r11e, 
         r11f, r11g, r11h, r11i, r12a, m1a)
ivory_informal$country <- "Ivory Coast"

mauritius_informal <- mauritius_informal %>% 
    select(a3a, a5, b1, b3, afb4a, b6, b8, b11, b12, 
         d4, l1a, l1b, k1, k3, k4a, k4b,  k4c, k4d,
         k4e, k4f, k4g, k5, k6, k9, k10, k11, k12, 
         k13, k16, k18, k19, k30, r6a, r6b, r6c,
         r6d, r6e, r6f, r7a, r11a, r11b, r11c, r11d,
         r11e, r11f, r11g, r11h, r11i, r12a, m1a)
mauritius_informal$country <- "Mauritius"

burkina_informal <- burkina_informal %>% 
  select(a2x, a3a, a3b, b1, b12, l1a, l1b, b3, b10, afb6, b11, b15,
         b21, b22, d4, k1, k4a, k4b, k4c, k4d, k4e, k4f, k4g,
         k5, k6, k9, k10, k11, k12, k13, k16, k17, k18, r1, r2a,
         r6a, r6b, r6c, r6d, r6e, r6f, r6g, r6h, r6i, r7a)
burkina_informal$country <- "Burkina Faso"

capeverde_informal <- capeverde_informal %>% 
  select(a3a, b1, b3, afb6, b12, b11, b21, b22,
         d4, l1a, l1b, k1, k4a, k4b,  k4c, k4d, k4e,
         k4f, k4g, k5, k6, k9, k10, k11, k12, k13,
         k16, k17, k18, r1, r2a, r6a, r6b, r6c, r6d,
         r6e, r6f, r6g, r6h, r6i, r7a, m1a)
capeverde_informal$country <- "Cape Verde"

mali_informal <- mali_informal %>% 
  select(a3a, Sc2a, Sc2b, b1, b3, b12, b11,
         b21, b22, d4, l1a, l1b, k1, k3, k4a,
         k4b, k4c, k4d, k4e, k4f, k4g, k5, k6, 
         k9, k10, k11, k12, k13, k16, k17, k18,
         r1, r2a, r6a, r6b, r6c, r6d, r6e, r6f, 
         r6g, r6h, r6i, r7a, m1a)
mali_informal$country <- "Mali"


botswana_informal <- botswana_informal %>% 
  select(a3a, b1, b3, b12, b11, b21, b22, d4, l1a, 
         k1, k4a, k4b,  k4c, k4d, k4e, k4f, k4g, k5, 
         k6, k9, k10, k11, k12, k13, k16, k17, k18, 
         r1, r2a, r6a, r6b, r6c, r6d, r6e, r6f, r6g, 
         r6h, r6i, r7a, m1a)
botswana_informal$country <- "Botswana"

angola_informal <- angola_informal %>% 
  select(a3a, Sc2x, Sc2a, b1, b3, b11, b21, b22, b12,
         d4, l1a, k1, k4a, k4b,  k4c, k4d, k4e, k4f,
         k4g, k5, k6, k9, k10, k11, k12, k13, k16, k17, 
         k18, r1, r2a, r6a, r6b, r6c, r6d, r6e, r6f, r6g,
         r6h, r6i, r7a, m1a)
angola_informal$country <- "Angola"

rwanda_informal <- rwanda_informal %>%
  select(a3a, sc2a, b1, b3, b12, b11, b15, b21, b22, d4, l1a,
         k3, k4a, k4b,  k4c, k4d, k4e, k4f, k4g, k5, k6, k9, k10,
         k11, k12, k13, k16, k17, k18, r1, r2a, r6a, r6b, r6c, r6g, m1a)
rwanda_informal$country <- "Rwanda"

nepal_informal <- nepal_informal %>% 
  select(a1, a3a, a2x, b1, b3, b12, b11, b15, b21, b22, d4, l1a, k3,
         k4a, k4b,  k4c, k4d, k4e, k4f, k4g, k5, k6, k9, k10, k11, k12, 
         k13, k16, k17, k18, r1, r2, r2a, r6a, r6b, r6c, r6g, m1)
nepal_informal$country <- "Nepal"

myanmar_informal <- myanmar_informal %>% 
  select(a3a, b3, b11, b12, b15, b21, b22, b27, d4, d12, k3, 
         k4a, k4b, k4c, k4d, k4e, k4f, k5, k10, k12, k13, k16, 
         k17, k18, k30, L1a, L1b, r1, r2a, r2b, r2c, r2d, r2e, m1a)
myanmar_informal$country <- "Myanmar"

argentina_informal <- argentina_informal %>%
  select(a3a, b3, b11, b12, b15, b21, b22, b27, d4, d12,
         k3, k4a, k4b,  k4c, k4d, k4e, k4f, k5, k10, k12, 
         k13, k16, k17, k18, k30, l1a, l1b, r1, r2a, r2b,
         r2c, r2d, r2e, m1)
argentina_informal$country <- "Argentina"

peru_informal <- peru_informal %>% 
  select(a3a, b3, b11, b12, b15, b21, b22, b27, d4, d12,
         k3, k4a, k4b,  k4c, k4d, k4e, k4f, k5, k10, k12, 
         k13, k16, k17, k18, k30, l1a, l1b, r1, r2a, r2b,
         r2c, r2d, r2e, m1)
peru_informal$country <- "Peru"



```

I use a for loop to add a "formality" column with constant value 0 to all 10 datasets: 
```{r}

filenames <- names(which(sapply(.GlobalEnv, is.data.frame)))
for(i in seq_along(filenames)) {
  x <- get(filenames[i])
  for(j in 1:length(x))
  {
    x$formality[[j]] <- 0
  }
  assign(filenames[i], x)
}
```

# Perceived Benefits of Registering

## Some Data Cleaning
```{r}
mad_benefits <- madaga_informal %>% select(r11a, r11b, r11c, r11d, r11e, 
         r11f, r11g, r11h, r11i, r12a)
ivo_benefits <- ivory_informal %>% select(r11a, r11b, r11c, r11d, r11e, 
         r11f, r11g, r11h, r11i, r12a)
mau_benefits <- mauritius_informal %>% select(r11a, r11b, r11c, r11d,
         r11e, r11f, r11g, r11h, r11i, r12a)
bur_benefits <- burkina_informal %>% select(r6a, r6b, r6c, r6d, r6e, 
         r6f, r6g, r6h, r6i, r7a)
cap_benefits <- capeverde_informal %>% select(r6a, r6b, r6c, r6d,
         r6e, r6f, r6g, r6h, r6i, r7a)
mal_benefits <- mali_informal %>% select(r6a, r6b, r6c, r6d, r6e, r6f, 
         r6g, r6h, r6i, r7a)
bot_benefits <- botswana_informal %>% select(r6a, r6b, r6c, r6d, r6e, r6f, r6g, 
         r6h, r6i, r7a)
ang_benefits <- angola_informal %>% select(r6a, r6b, r6c, r6d, r6e, r6f, r6g,
         r6h, r6i, r7a)

colnames(mad_benefits) <-  c("finance", "raw_materials", "less_bribes", "legal_foundations", 
           "gvt_programs", "workers", "formal_firms", "markets", "services", 
          "most_important")

colnames(ivo_benefits) <-  c("finance", "raw_materials", "less_bribes", "legal_foundations", 
           "gvt_programs", "workers", "formal_firms", "markets", "services", 
          "most_important")

colnames(mau_benefits) <-  c("finance", "raw_materials", "less_bribes", "legal_foundations", 
           "gvt_programs", "workers", "formal_firms", "markets", "services", 
          "most_important")

colnames(bur_benefits) <-  c("finance", "raw_materials", "less_bribes", "legal_foundations", 
           "gvt_programs", "workers", "formal_firms", "markets", "services", 
          "most_important")

colnames(cap_benefits) <-  c("finance", "raw_materials", "less_bribes", "legal_foundations", 
           "gvt_programs", "workers", "formal_firms", "markets", "services", 
          "most_important")

colnames(mal_benefits) <-  c("finance", "raw_materials", "less_bribes", "legal_foundations", 
           "gvt_programs", "workers", "formal_firms", "markets", "services", 
          "most_important")

colnames(bot_benefits) <-  c("finance", "raw_materials", "less_bribes", "legal_foundations", 
           "gvt_programs", "workers", "formal_firms", "markets", "services", 
          "most_important")

colnames(ang_benefits) <-  c("finance", "raw_materials", "less_bribes", "legal_foundations", 
           "gvt_programs", "workers", "formal_firms", "markets", "services", 
          "most_important")

perceived_benefits <- rbind(mad_benefits, ivo_benefits, mau_benefits, bur_benefits,
                            cap_benefits, mal_benefits, bot_benefits, ang_benefits)

perceived_benefits[perceived_benefits == "don't know"] <- NA
perceived_benefits[perceived_benefits == "not applicable    "] <- NA
perceived_benefits[perceived_benefits == "not applicable"] <- NA
perceived_benefits[perceived_benefits == "do not know      "] <- NA
perceived_benefits[perceived_benefits == "Does Not Apply"] <- NA
perceived_benefits[perceived_benefits == "do not know"] <- NA
perceived_benefits[perceived_benefits == "Don't Know (Spontaneous)"] <- NA
perceived_benefits[perceived_benefits == "not applicable "] <- NA
perceived_benefits[perceived_benefits == "do not know    "] <- NA
perceived_benefits[perceived_benefits == "not applicable "] <- NA
perceived_benefits[perceived_benefits == "do not know   "] <- NA
perceived_benefits[perceived_benefits == "not applicable  "] <- NA
perceived_benefits[perceived_benefits == "Don\x92t know  (spontaneous)"] <- NA


perceived_benefits$finance <- droplevels(perceived_benefits$finance)
perceived_benefits$raw_materials <- droplevels(perceived_benefits$raw_materials)
perceived_benefits$less_bribes <- droplevels(perceived_benefits$less_bribes)
perceived_benefits$legal_foundations <- droplevels(perceived_benefits$legal_foundations)
perceived_benefits$gvt_programs <- droplevels(perceived_benefits$gvt_programs)
perceived_benefits$workers <-droplevels(perceived_benefits$workers)
perceived_benefits$formal_firms <- droplevels(perceived_benefits$formal_firms)
perceived_benefits$markets <- droplevels(perceived_benefits$markets)
perceived_benefits$services <-droplevels(perceived_benefits$services)
perceived_benefits$most_important <- droplevels(perceived_benefits$most_important)

levels(perceived_benefits$finance)[c(2, 4, 6)] <- "No"
levels(perceived_benefits$finance)[c(1, 3, 5)] <- "Yes" 

levels(perceived_benefits$raw_materials)[c(2, 4, 6)] <- "No"
levels(perceived_benefits$raw_materials)[c(1, 3, 5)] <- "Yes" 

levels(perceived_benefits$less_bribes)[c(2, 4, 6)] <- "No"
levels(perceived_benefits$less_bribes)[c(1, 3, 5)] <- "Yes" 

levels(perceived_benefits$legal_foundations)[c(2, 3, 5)] <- "No"
levels(perceived_benefits$legal_foundations)[c(1, 4)] <- "Yes" 

levels(perceived_benefits$gvt_programs)[c(2, 3, 5)] <- "No"
levels(perceived_benefits$gvt_programs)[c(1, 4)] <- "Yes" 

levels(perceived_benefits$workers)[c(2, 3, 5)] <- "No"
levels(perceived_benefits$workers)[c(1, 4)] <- "Yes" 

levels(perceived_benefits$formal_firms)[c(2, 3, 5)] <- "No"
levels(perceived_benefits$formal_firms)[c(1, 4)] <- "Yes" 

levels(perceived_benefits$markets)[c(2, 3, 5)] <- "No"
levels(perceived_benefits$markets)[c(1, 4)] <- "Yes" 

levels(perceived_benefits$services)[c(2, 3, 5)] <- "No"
levels(perceived_benefits$services)[c(1, 4)] <- "Yes" 

levels(perceived_benefits$most_important)[c(1, 10, 19)] <- "Better access to financing" 
levels(perceived_benefits$most_important)[c(2, 10, 18)] <- "Better access to raw materials"
levels(perceived_benefits$most_important)[c(3, 10, 17)] <- "Less bribes to pay"
levels(perceived_benefits$most_important)[c(4, 10, 16)] <- "Better legal foundations on the property rights of land and buildings" 
levels(perceived_benefits$most_important)[c(5, 10, 15)] <- "More access to government programs or services"
levels(perceived_benefits$most_important)[c(6, 10, 14)] <- "Better access to workers"
levels(perceived_benefits$most_important)[c(7, 10, 13)] <- "Better opportunities with formal firms"
levels(perceived_benefits$most_important)[c(8, 10, 12)] <- "Better access to markets"
levels(perceived_benefits$most_important)[c(9, 10, 11)] <- "Better access to infrastructure services"

perceived_benefits$most_important <- droplevels(perceived_benefits$most_important)

lapply(perceived_benefits, FUN = levels)

```

## Visualization Benefits 

### Tidy Format
```{r}
# putting the data into tidy format to perform better data visualization 

benefits_viz <- perceived_benefits %>% select(-most_important) %>% 
  gather(key = "benefit", value = "value")

benefits_viz$benefit <- as.factor(benefits_viz$benefit)
levels(benefits_viz$benefit) <- c("Better Access to Financing", "Better Opportunities with Formal Firms", 
                                   "More Access to Government Programs", "Better Legal Foundations",
                                  "Less Bribes to Pay", "Better Access to Markets", 
                                  "Better Access to Materials", "Better Access to Infrastructure Services",
                                  "Better Access to Workers")

benefits_viz$value <- factor(benefits_viz$value, levels = c("Yes", "No"))

```

### Barplot 1 Registration Benefits
```{r}
benefits_viz %>% filter(!is.na(value)) %>%
ggplot(aes(x = value)) + geom_bar(stat = "count", fill = "dodgerblue3", width = 0.75) + 
  facet_wrap(benefit ~., nrow = 4) + theme_economist() + 
  xlab("Perceived Benefit") + 
  ggtitle("Barplots Perceived Benefit of Formalization") + ylab("Count") + 
  theme(plot.title = element_text(color="dark blue", size=20, face="bold", hjust = 0.5),
        axis.title.x = element_text(color="dark blue", size=15, face="bold.italic", hjust = 0.5), 
        axis.title.y = element_text(color="dark blue", size=15, face="bold.italic", vjust = 0.5)) + 
  theme(strip.text.x = element_text(size = 8, colour = "dark blue", face = "bold.italic"), 
        axis.text.x = element_text(color="midnightblue", size=10.5, face="bold"),
        axis.text.y = element_text(color="midnightblue", size=10.5, face="bold"))
```


```{r eval=FALSE, include=FALSE}
  benefits_viz %>% filter(!is.na(value)) %>%
    ggplot(aes(x = value)) + geom_bar(stat = "count", fill = "dodgerblue3", width = 0.65) + 
    facet_wrap(benefit ~., nrow = 4) + theme_economist() + 
    xlab("Perceived Benefit") + 
    ggtitle("Barplots Perceived Benefit of Formalization") + ylab("Count") + 
    theme(plot.title = element_text(color="midnightblue", size=24, face="bold", hjust = 0.5),
          axis.title.x = element_text(color="dark blue", size=16, face="bold.italic", hjust = 0.5), 
          axis.title.y = element_text(color="dark blue", size=16, face="bold.italic", vjust = 0.5)) + 
    theme(strip.text.x = element_text(size = 15, colour = "navyblue", face = "bold"), 
          axis.text.x = element_text(color="midnightblue", size=14, face="bold"),
          axis.text.y = element_text(color="midnightblue", size=14, face="bold"))
```

 **the gap between the frequency of yes/no answers is the greatest for "Better Access to Financing"**
 
### Barplot 2: Most Important Benefit

**When asked to identify the most important benefit of registering their businesses, firms overwhelmingly chose access to finance.** 

```{r}
levels(perceived_benefits$most_important)[4] <- "Better legal foundations"
levels(perceived_benefits$most_important)[5] <- "More access to government programs or services"
perceived_benefits %>% filter(!is.na(most_important)) %>%
ggplot(aes(x = most_important, fill = most_important)) + geom_bar(aes(y=..count../sum(..count..))) + 
  scale_fill_discrete(name = "Most Important Benefit") +  
  ggtitle("Most Important Perceived Benefit of Formalization") + ylab("Frequency") + theme_economist() +
  theme(plot.title = element_text(color="dark blue", size= 19, face="bold", hjust = 0.5),
        axis.title.x = element_blank(), axis.text.x = element_blank(), axis.ticks.x = element_blank(),
        axis.title.y = element_text(color="dark blue", size=15, face="bold.italic", vjust = 0.5), 
        axis.text.y = element_text(color="midnightblue", size=11, face="bold"), axis.line.x =  element_blank()) + 
  theme(legend.title = element_text (color = "dark blue", size = 15, face = "bold"),
        legend.text  = element_text(color = "dark blue", size = 13, face = "bold.italic"), 
        legend.position=c(0.6,0.6), legend.box = "vertical", legend.background = element_rect(fill="transparent"))


          
perceived_benefits %>% filter(!is.na(most_important)) %>%
  ggplot(aes(x = most_important, fill = most_important)) + geom_bar(aes(y=..count../sum(..count..))) + 
  scale_fill_discrete(name = "Most Important Benefit") +  
  ggtitle("Most Important Perceived Benefit of Formalization") + ylab("Frequency") + theme_economist() +
  theme(plot.title = element_text(color = "dark blue", size = 19, face = "bold", hjust = 0),
        axis.title.x = element_blank(), axis.text.x = element_blank(), axis.ticks.x = element_blank(),
        axis.title.y = element_text(color = "dark blue", size = 15, face = "bold.italic", vjust = 0.5), 
        axis.text.y = element_text(color = "midnightblue", size = 11, face = "bold"), axis.line.x =  element_blank()) + 
  theme(legend.title = element_text (color = "dark blue", size = 15, face = "bold"),
        legend.text  = element_text(color = "dark blue", size = 13, face = "bold.italic"), 
        legend.position= "right", legend.box = "vertical", legend.background = element_rect(fill="transparent"))
                  
```


# Obstacles to Business Formalization 

I will examine what are the major obstacles preventing informal firms from formally registering and whether some obstacles are more burdensome for specific types of informal firms, namely firms managed by women and “reluctant entrepreneurs”, which can offer important policy insights when designing Formalization Assistance Programs. 

I will only use various subsets of countries because some datasets do not contain the relevant variables. 

## 1st set of countries: Madagascar, Mauritius, Ivory Coast 

### Data Cleaning
```{r warning=FALSE}
# selecting relevant variables

mad_obstacles <- madaga_informal %>% 
  select(b3, b6, r6a, r6b, r6c, r6d, r6e, r6f)

mau_obstacles <- mauritius_informal %>% 
  select(b3, b6, r6a, r6b, r6c, r6d, r6e, r6f)

ivo_obstacles <- ivory_informal %>% 
  select(b3, b6, r6a, r6b, r6c, r6d, r6e, r6f)

obstacles1 <- rbind(mad_obstacles, mau_obstacles, ivo_obstacles)
obstacles1 <- obstacles1 %>% select(-c(b3,b6)) %>% gather(key = "obstacle", value = "degree")

# levels of factor column "obstacles"

obstacles1$obstacle <- as.factor(obstacles1$obstacle)
levels(obstacles1$obstacle) <- c("Information on Registration Procedures",
                                 "Time to Complete Registration Procedures", 
                                 "Registration Fees", "Taxes on Registered Businesses", 
                                 "Inspections by Government Officials",
                                 "Bribes on Registered Businesses")


# levels of "degree" factor variable 

obstacles1$degree <- as.factor(obstacles1$degree)
obstacles1$degree[obstacles1$degree == "does not apply"] <- NA
obstacles1$degree[obstacles1$degree == "don't know"] <- NA
obstacles1$degree <- droplevels(obstacles1$degree)
levels(obstacles1$degree) <- c("Major", "Minor", "Moderate", "No Obstacle", "Severe")
obstacles1$degree <- factor(obstacles1$degree, levels = c("No Obstacle", "Minor", "Moderate", "Major", "Severe"))



```

### Faceted Barplot

```{r}
obstacles1 %>% filter(!is.na(degree)) %>% 
ggplot(aes(x = degree)) + geom_bar(stat = "count", width = 0.7, fill = "lightsalmon") +
  facet_wrap(obstacle ~., nrow = 3) + theme_economist() + xlab("How Much of an Obstacle") +
  ggtitle("Barplot Obstacles to Formalization") + ylab("Count") + 
    theme(plot.title = element_text(color="midnightblue", size=20, face="bold", hjust = 0.5),
          axis.title.x = element_text(color="dark blue", size=12, face="bold.italic", hjust = 0.5), 
          axis.title.y = element_text(color="dark blue", size=12, face="bold.italic", vjust = 0.5)) + 
    theme(strip.text.x = element_text(size = 10.5, colour = "navyblue", face = "bold"), 
          axis.text.x = element_text(color="midnightblue", size=10, face="bold"),
          axis.text.y = element_text(color="midnightblue", size=10, face="bold"))
```


## 2nd set of countries: Myanmar, Peru, Argentina 

#### Data Cleaning
```{r}
mya_obstacles <- myanmar_informal %>% 
  select(b3, r2a, r2b, r2c, r2d, r2e)

per_obstacles <- peru_informal %>% 
  select(b3, r2a, r2b, r2c, r2d, r2e)

arg_obstacles <- argentina_informal %>% 
  select(b3, r2a, r2b, r2c, r2d, r2e)

obstacles2 <- rbind(mya_obstacles, per_obstacles, arg_obstacles)

obstacles2 <- obstacles2 %>% gather(key = obstacle, value = "degree", -c(b3))

# levels "obstacles" factor column 

obstacles2$obstacle <- as.factor(obstacles2$obstacle)
levels(obstacles2$obstacle) <- c("Time, Fees and Paper Work Required", 
                                 "Taxes on Registered Businesses", 
                                 "Inspections by Government Officials",
                                 "Bribes on Registered Businesses", 
                                 "No Benefit from Being Registered")

# levels "degree" variable 
obstacles2$degree <- as.factor(obstacles2$degree)
obstacles2$degree[obstacles2$degree == "Don't Know"] <- NA
obstacles2$degree[obstacles2$degree == "Don\x92t know"] <- NA
obstacles2$degree <- droplevels(obstacles2$degree)
```

### Barplot 
```{r}
obstacles2 %>% filter(!is.na(degree)) %>% 
ggplot(aes(x = degree)) + geom_bar(stat = "count", width = 0.5, fill = "dodgerblue4") +
  facet_wrap(obstacle ~., nrow = 3) + theme_gdocs() + xlab("Obstacle") +
  ggtitle("Barplot Obstacles to Formalization") + ylab("Count") + 
    theme(plot.title = element_text(color="midnightblue", size=20, face="bold.italic", hjust = 0.5),
          axis.title.x = element_text(color="dark blue", size=15, face="bold.italic", hjust = 0.5), 
          axis.title.y = element_text(color="dark blue", size=15, face="bold.italic", vjust = 0.5)) + 
    theme(strip.text.x = element_text(size = 10, colour = "navyblue", face = "bold"), 
          axis.text.x = element_text(color="midnightblue", size=10, face="bold"),
          axis.text.y = element_text(color="midnightblue", size=10, face="bold"))

```


## 3rd set of 9 countries: Madacasgar, Mauritius, Ivory Coast, Burkina Faso, Cape Verde, Mali, Botswana, Angola and Nepal 

### Cleaning
```{r}
main_obstacle <- bind_rows(madaga_informal[,c(40, 52)], mauritius_informal[,c(39, 51)],
                           ivory_informal[,c(38, 50)], burkina_informal[,c(35, 46)],
                           capeverde_informal[,c(31, 43)], mali_informal[,c(33, 45)], 
                           botswana_informal[,c(29, 41)], angola_informal[,c(31, 43)],
                           nepal_informal[,c(32,39)])
# un-factoring columns 
main_obstacle$r7a <- as.character(main_obstacle$r7a)
main_obstacle$r2a <- as.character(main_obstacle$r2a)
main_obstacle$r2 <- as.character(main_obstacle$r2)

# cleaning
main_obstacle[389:975, 1] <- main_obstacle[389:975, 3]
main_obstacle[976:1095, 1] <- main_obstacle[976:1095, 4]
main_obstacle <- main_obstacle[,c(2,1)]
colnames(main_obstacle) <- c("country", "obstacle")

# transforming into factors 

main_obstacle$country <- as.factor(main_obstacle$country)
main_obstacle$obstacle <- as.factor(main_obstacle$obstacle)

main_obstacle$obstacle[main_obstacle$obstacle == "dk"] <- NA
main_obstacle$obstacle[main_obstacle$obstacle == "don't know"] <- NA
main_obstacle$obstacle[main_obstacle$obstacle == "Don\x92t know"] <- NA
main_obstacle$obstacle[main_obstacle$obstacle == "Other"] <- NA
main_obstacle$obstacle[main_obstacle$obstacle == "other (specify)                                                      "] <- NA
main_obstacle$obstacle <- droplevels(main_obstacle$obstacle)

levels(main_obstacle$obstacle)[c(2,3)] <- levels(main_obstacle$obstacle)[1]
levels(main_obstacle$obstacle)[c(2,3,5)] <- levels(main_obstacle$obstacle)[4]
levels(main_obstacle$obstacle)[c(3,5,6)] <- levels(main_obstacle$obstacle)[4]
levels(main_obstacle$obstacle)[c(5,10)] <- levels(main_obstacle$obstacle)[4]
levels(main_obstacle$obstacle)[c(5,6, 8)] <- levels(main_obstacle$obstacle)[7]
levels(main_obstacle$obstacle)[c(6, 8)] <- levels(main_obstacle$obstacle)[7]
levels(main_obstacle$obstacle)[c(7,8, 10)] <- levels(main_obstacle$obstacle)[9]

levels(main_obstacle$obstacle) <- c("Bribes on Registered Businesses", "Registration Fees", 
                                    "Getting Information on Registration Procedures", 
                                    "Inspections by Government Officials", "Taxes", 
                                    "No Registration Benefits", "Time Registration Procedures")
```

### Barplot Main Obstacle Overall: 

```{r}
main_obstacle %>% filter(!is.na(obstacle)) %>% 
ggplot(aes(x = obstacle, fill = obstacle)) + geom_bar(stat = "count", width = 0.7) + 
  scale_fill_discrete(name = "Main Obstacle") +  
  ggtitle("Main Obstacle to Business Formalization") + ylab("Count") + theme_economist() +
  theme(plot.title = element_text(color="dark blue", size=19, face="bold", hjust = 0),
        axis.title.x = element_blank(), axis.text.x = element_blank(), axis.ticks.x = element_blank(),
        axis.title.y = element_text(color="dark blue", size=15, face="bold.italic", vjust = 0.5), 
        axis.text.y = element_text(color="midnightblue", size=11, face="bold"), axis.line.x =  element_blank()) + 
  theme(legend.title = element_text (color = "dark blue", size = 14, face = "bold"),
        legend.text  = element_text(color = "dark blue", size = 11, face = "bold.italic"), 
        legend.position= "right", legend.box = "vertical", legend.background = element_rect(fill="transparent"))
```



###  Barplot Main Obstacle by Country:
```{r}

main_obstacle %>% filter(!is.na(obstacle)) %>% 
ggplot(aes(x = obstacle, fill = obstacle)) + geom_bar(stat = "count", width = 0.7) + 
  facet_wrap(country ~.) +  scale_fill_discrete(name = "Main Obstacle") +  
  ggtitle("Main Obstacle to Business Formalization by Country") + ylab("Count") + theme_economist() +
  theme(plot.title = element_text(color="dark blue", size=17.5, face="bold", hjust = 0.),
        axis.title.x = element_blank(), axis.text.x = element_blank(), axis.ticks.x = element_blank(),
        axis.title.y = element_text(color="dark blue", size=15, face="bold.italic", vjust = 0.5), 
        axis.text.y = element_text(color="midnightblue", size=11, face="bold"), axis.line.x =  element_blank(),
        strip.text.x = element_text(size = 8.5, colour = "navyblue", face = "bold")) + 
  theme(legend.title = element_text (color = "dark blue", size = 14, face = "bold"),
        legend.text  = element_text(color = "dark blue", size = 10.5, face = "bold.italic"), 
        legend.position= "right", legend.box = "vertical", legend.background = element_rect(fill="transparent"))
```


### Proportion Table Main Obstacle: 

```{r}
table <- as.matrix(round(prop.table(table(main_obstacle$obstacle)), 4)) 
table <- as.data.frame(table)
table$Obstacle <- rownames(table)
table <- table[c(2,1)]
colnames(table)[2] <- "Proportion"
table <- arrange(table, desc(Proportion))
table$Proportion <- percent(table$Proportion)

table %>% 
  kable() %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), 
                full_width = F, font_size = 18)
```

# Regression Analysis:

Questions: 
What are the main determinants of access to finance? Do registered firms have better access to capital because of their formal status or because formality is often associated with higher managerial ability or other confounders of formality?
We will determine wether formality can explain variation in access to finance while controlling for a variety of factors traditionally correlated with financial inclusion.
 what is the predictive power of formality on measures of financial inclusion? 


## Further Cleaning Informal Survey Datasets: Madacasgar, Ivory Coast, Mauritius

**Explanatory Variables:** 
Country (fixed effects)
Formality
Owner Gender (Female = 1)
Owner's Education Level 
Owner's Years of Experience 
Owner has Local Nationality 
Years in Operation 
Size (number of employees)
Sales (converted to $US)
Reluctant Entrepreneur

**Reponse Variables**

Bank Account
Separate Business and Household Accounts 
Loan 
Loan Application
Reason for not Applying


### Madagascar:

```{r}

madaga_informal$size <- madaga_informal$l1a + madaga_informal$l1b
madaga_informal <- madaga_informal %>% select(-c(l1a, l1b))

madaga_informal <- madaga_informal %>% 
  select(country, formality, b3, b11, b12,afb4a, b8, size, d4, b6,
        k10, k12, k13, k16, k18, k19, k30)



colnames(madaga_informal)[-c(1,2)] <- c("female_owner", "edu_level", "experience", "nationality", 
                                        "yrs_operation", "size", "sales", "reluctant", 
                                        "bank_account", "loan", "source_loan", "collateral", "loan_application",
                                        "reason_no_app", "obstacle_finance") 

madaga_informal[madaga_informal == "don't know"] <- NA

# gender variable  as dichotomous (female = 1)
madaga_informal$female_owner <- droplevels(madaga_informal$female_owner)
levels(madaga_informal$female_owner) <- c(1, 0)

# education level 
madaga_informal$edu_level <- droplevels(madaga_informal$edu_level)
levels(madaga_informal$edu_level) 
levels(madaga_informal$edu_level) <- c(1, 2, 3, 4, 5)

# nationality 
madaga_informal$nationality <- droplevels(madaga_informal$nationality)
levels(madaga_informal$nationality) <- 1

# years in operation

madaga_informal$yrs_operation <- 2009 - madaga_informal$yrs_operation

#sales
madaga_informal$sales[madaga_informal$sales == -9] <- NA
madaga_informal$sales <- madaga_informal$sales * 0.00052 # converting to $US

# being 'reluctant entrepreneur'
madaga_informal$reluctant[madaga_informal$reluctant == "other"] <- NA
madaga_informal$reluctant <- droplevels(madaga_informal$reluctant)
levels(madaga_informal$reluctant) 
levels(madaga_informal$reluctant) <- c(0, 1)

# bank account, separate account, loan, collateral, loan application

madaga_informal$bank_account <-  droplevels(madaga_informal$bank_account)
madaga_informal$loan <- droplevels(madaga_informal$loan)
madaga_informal$collateral <- droplevels(madaga_informal$collateral)
madaga_informal$loan_application <- droplevels(madaga_informal$loan_application)

levels(madaga_informal$bank_account) <- c(1,0)
levels(madaga_informal$loan) <- c(1,0)
levels(madaga_informal$collateral) <- c(1,0)
levels(madaga_informal$loan_application) <- c(1,0)

```



### Ivory Coast: 

```{r echo=FALSE, warning=FALSE}

ivory_informal$l1a <- as.numeric(as.character(ivory_informal$l1a))
ivory_informal$l1b <- as.numeric(as.character(ivory_informal$l1b))
ivory_informal$size <- ivory_informal$l1a + ivory_informal$l1b
ivory_informal <- ivory_informal %>% select(-c(l1a, l1b))

ivory_informal <- ivory_informal %>% 
  select(country, formality, b3, b11, b12,afb4a, b8, size, d4, b6,
         k10, k12, k13, k16, k18, k19, k30)

colnames(ivory_informal)[-c(1,2)] <- c("female_owner", "edu_level", "experience", "nationality", 
                                        "yrs_operation", "size", "sales", "reluctant", 
                                        "bank_account", "loan", "source_loan", "collateral", "loan_application",
                                        "reason_no_app", "obstacle_finance") 

ivory_informal[ivory_informal == "don't know"] <- NA 

# gender variable as dichotomous (female = 1)
ivory_informal$female_owner <- droplevels(ivory_informal$female_owner)
levels(ivory_informal$female_owner) <- c(1, 0)

# education level 
ivory_informal$edu_level <- droplevels(ivory_informal$edu_level)
levels(ivory_informal$edu_level) 
levels(ivory_informal$edu_level) <- c(1, 2, 3, 4, 5)

# nationality 
ivory_informal$nationality <- droplevels(ivory_informal$nationality)
levels(ivory_informal$nationality)[1] <- 1
levels(ivory_informal$nationality)[2:5] <- 0

# years in operation
ivory_informal$yrs_operation <- as.numeric(as.character(ivory_informal$yrs_operation))
ivory_informal$yrs_operation <- 2009 - ivory_informal$yrs_operation

#sales
ivory_informal$sales <- as.numeric(as.character(ivory_informal$sales))
ivory_informal$sales[ivory_informal$sales == -9] <- NA
ivory_informal$sales <- ivory_informal$sales * 	0.0022  # converting to $US

# being 'reluctant entrepreneur'
ivory_informal$reluctant[ivory_informal$reluctant == "other"] <- NA
ivory_informal$reluctant <- droplevels(ivory_informal$reluctant)
levels(ivory_informal$reluctant) 
levels(ivory_informal$reluctant) <- c(0, 1)

# bank account, separate account, loan, collateral, loan application

ivory_informal$bank_account <-  droplevels(ivory_informal$bank_account)
ivory_informal$loan <- droplevels(ivory_informal$loan)
ivory_informal$collateral <- droplevels(ivory_informal$collateral)
ivory_informal$loan_application <- droplevels(ivory_informal$loan_application)

levels(ivory_informal$bank_account) <- c(1,0)
levels(ivory_informal$loan) <- c(1,0)
levels(ivory_informal$collateral) <- c(1,0)
levels(ivory_informal$loan_application) <- c(1,0)


```

### Mauritius: 

```{r echo=FALSE}

mauritius_informal$size <- mauritius_informal$l1a + mauritius_informal$l1b
mauritius_informal <- mauritius_informal %>% select(-c(l1a, l1b))

mauritius_informal <- mauritius_informal %>% 
  select(country, formality, b3, b11, b12,afb4a, b8, size, d4, b6,
         k10, k12, k13, k16, k18, k19, k30)

colnames(mauritius_informal)[-c(1,2)] <- c("female_owner", "edu_level", "experience", "nationality", 
                                        "yrs_operation", "size", "sales", "reluctant", 
                                        "bank_account", "loan", "source_loan", "collateral", "loan_application",
                                        "reason_no_app", "obstacle_finance") 

# gender variable as dichotomous (female = 1)
mauritius_informal$female_owner[mauritius_informal$female_owner == "don't know"] <- NA
mauritius_informal$female_owner <- droplevels(mauritius_informal$female_owner)
levels(mauritius_informal$female_owner) <- c(1, 0)

# education level 
mauritius_informal$edu_level[mauritius_informal$edu_level == "don't know"] <- NA
mauritius_informal$edu_level <- droplevels(mauritius_informal$edu_level)
levels(mauritius_informal$edu_level) 
levels(mauritius_informal$edu_level) <- c(1, 2, 3, 4, 5)

# nationality (local = 1)
mauritius_informal[mauritius_informal == "don't know"] <- NA 
mauritius_informal$nationality <- droplevels(mauritius_informal$nationality)
levels(mauritius_informal$nationality)[1:4] <- 0
levels(mauritius_informal$nationality)[5] <- 1

# years in operation 

mauritius_informal$yrs_operation <- 2009 - mauritius_informal$yrs_operation

#sales 
mauritius_informal$sales[mauritius_informal$sales == -9] <- NA
mauritius_informal$sales <- mauritius_informal$sales * 0.031153 # converting to $US

# being 'reluctant entrepreneur'
mauritius_informal$reluctant[mauritius_informal$reluctant == "other"] <- NA
mauritius_informal$reluctant <- droplevels(mauritius_informal$reluctant)
levels(mauritius_informal$reluctant) 
levels(mauritius_informal$reluctant) <- c(0, 1)

# bank account and loan 
mauritius_informal$bank_account <-  droplevels(mauritius_informal$bank_account)
mauritius_informal$loan <- droplevels(mauritius_informal$loan)
mauritius_informal$collateral <- droplevels(mauritius_informal$collateral)
mauritius_informal$loan_application <- droplevels(mauritius_informal$loan_application)

levels(mauritius_informal$bank_account) <- c(1,0)
levels(mauritius_informal$loan) <- c(1,0)
levels(mauritius_informal$collateral) <- c(1,0)
levels(mauritius_informal$loan_application) <- c(1,0)


```

## Loading Enterprise Survey Data (for Formal Firms) for 3 countries

### Importing the Data
```{r}

madaga_formal <- foreign::read.dta("Madagascar-2009--full data-1.dta")
ivory_formal <-  foreign::read.dta("Côte d'Ivoire-2009--full data-1.dta")
mauritius_formal <- foreign::read.dta("Mauritius_2009_idstd.dta")
```


### Selecting Variables

```{r}

# Madagascar

madaga_formal$country <- "Madagascar"
madaga_formal$formality <- 1

madaga_formal <- madaga_formal %>%
  select(country, formality, b3b, afb7a, b7, afb4a, b5, l1, d2, b3e, 
         k6, k8, k9, k13, k16, k17, k30)

colnames(madaga_formal)[-c(1,2)] <- c("female_owner", "edu_level", "experience", "nationality", 
                                        "yrs_operation", "size", "sales", "reluctant", 
                                        "bank_account", "loan", "source_loan", "collateral", "loan_application",
                                        "reason_no_app", "obstacle_finance") 

madaga_formal[madaga_formal == "don\x92t know "] <- NA
madaga_formal[madaga_formal == "don't know"] <- NA
madaga_formal$nationality <- droplevels(madaga_formal$nationality)
levels(madaga_formal$nationality) <- c(0, 0, 0, 0, 0, 1)

# Ivory Coast

ivory_formal$country <- "Ivory Coast"
ivory_formal$formality <- 1


ivory_formal <- ivory_formal %>%
  select(country, formality, b3b, afb7a, b7, afb4a, b5, l1, d2, b3e, 
         k6, k8, k9, k13, k16, k17, k30)

colnames(ivory_formal)[-c(1,2)] <- c("female_owner", "edu_level", "experience", "nationality", 
                                        "yrs_operation", "size", "sales", "reluctant", 
                                        "bank_account", "loan", "source_loan", "collateral", "loan_application",
                                        "reason_no_app", "obstacle_finance") 

ivory_formal[ivory_formal == "don\x92t know "] <- NA
ivory_formal[ivory_formal == "don't know"] <- NA
ivory_formal$nationality <- droplevels(ivory_formal$nationality)
levels(ivory_formal$nationality) <- c(1, 0, 0, 0, 0, 0, 0)

# Mauritius 


mauritius_formal$country <- "Mauritius"
mauritius_formal$formality <- 1


mauritius_formal <- mauritius_formal %>%
  select(country, formality, b3b, afb7a, b7, afb4a, b5, l1, d2, b3e, 
         k6, k8, k9, k13, k16, k17, k30)

colnames(mauritius_formal)[-c(1,2)] <- c("female_owner", "edu_level", "experience", "nationality", 
                                        "yrs_operation", "size", "sales", "reluctant", 
                                        "bank_account", "loan", "source_loan", "collateral", "loan_application",
                                        "reason_no_app", "obstacle_finance") 

mauritius_formal[mauritius_formal == "don\x92t know "] <- NA
mauritius_formal[mauritius_formal == "don't know"] <- NA

mauritius_formal$nationality <- droplevels(mauritius_formal$nationality)
levels(mauritius_formal$nationality) <- c(0, 0, 0, 0, 0, 1)




```

### Sales Variable: Converting Local Currency to $ US

```{r}
# dividing sales variable by 12 to get monthly sales
madaga_formal$sales[madaga_formal$sales == -9] <- NA
ivory_formal$sales[ivory_formal$sales == -9] <- NA
mauritius_formal$sales[mauritius_formal$sales == -9] <- NA

madaga_formal$sales <- madaga_formal$sales/12
ivory_formal$sales <- ivory_formal$sales/12
mauritius_formal$sales <- mauritius_formal$sales/12

# converting Mauritian Rupees to US dollars with 2009 exchange rate (surveys were conducted in 2009)
madaga_formal$sales <- madaga_formal$sales * 0.00052
mauritius_formal$sales <- mauritius_formal$sales * 0.031153 
ivory_formal$sales <- ivory_formal$sales * 	0.0022 

```


### Row-Binding datasets and Cleaning:  

```{r}
formal <- rbind(madaga_formal, mauritius_formal, ivory_formal)

# gender variable  as dichotomous (female = 1)
formal$female_owner <- droplevels(formal$female_owner)
levels(formal$female_owner) <- c(1, 0)

# education level 
formal$edu_level <- droplevels(formal$edu_level)
levels(formal$edu_level) 
levels(formal$edu_level) <- c(1, 2, 3, 4, 4, 5, 6, 7, 7)

# years in operation

formal$yrs_operation <- 2009 - formal$yrs_operation

# being 'reluctant entrepreneur'
formal$reluctant[formal$reluctant == "don\x92t know"] <- NA
formal$reluctant <- droplevels(formal$reluctant)
levels(formal$reluctant) 
levels(formal$reluctant) <- c(0, 1)

# bank account, separate account, loan, collateral, loan application

formal$bank_account <-  droplevels(formal$bank_account)
formal$loan <- droplevels(formal$loan)
formal$collateral <- droplevels(formal$collateral)
formal$loan_application <- droplevels(formal$loan_application)

levels(formal$bank_account) <- c(1,0)
levels(formal$loan) <- c(1,0)
levels(formal$collateral) <- c(1,0)
levels(formal$loan_application) <- c(1,0)


```

### Binding datasets formal and informal
```{r}
regression <- rbind(madaga_informal, mauritius_informal, ivory_informal, formal)


# transforming finance as an obstacle into a dichotomous variable:
 regression$obstacle_finance[regression$obstacle_finance == "does not apply"] <- NA
regression$obstacle_finance <- droplevels(regression$obstacle_finance)
levels(regression$obstacle_finance)
regression$obstacle_finance5 <- regression$obstacle_finance
levels(regression$obstacle_finance) <- c(0, 0, 1, 1, 1)
levels(regression$obstacle_finance5) <- c(1, 2, 3, 4, 5)

```

## Burkina Faso, Cape Verde 

### Informal Survey
```{r}

burkina_informal$size <- burkina_informal$l1a + burkina_informal$l1b
burkina_informal$nationality <- NA
burkina_informal$obstacle_finance <- NA
burkina_informal <- burkina_informal %>%
  select(country, formality, b3, b21, b11, nationality, b12, size, d4, afb6,
         k10, k12, k13, k16, k17, k18, obstacle_finance)

colnames(burkina_informal)[-c(1,2)] <- c("female_owner", "edu_level", "experience", "nationality", 
                                        "yrs_operation", "size", "sales", "reluctant", 
                                        "bank_account", "loan", "source_loan", "collateral", "loan_application",
                                        "reason_no_app", "obstacle_finance") 

capeverde_informal$size <- capeverde_informal$l1a + capeverde_informal$l1b
capeverde_informal$nationality <- NA
capeverde_informal$obstacle_finance <- NA 
capeverde_informal <- capeverde_informal %>%
  select(country, formality, b3, b21, b11, nationality, b12, size, d4, afb6,
         k10, k12, k13, k16, k17, k18, obstacle_finance)

colnames(capeverde_informal)[-c(1,2)] <- c("female_owner", "edu_level", "experience", "nationality", 
                                        "yrs_operation", "size", "sales", "reluctant", 
                                        "bank_account", "loan", "source_loan", "collateral", "loan_application",
                                        "reason_no_app", "obstacle_finance") 

```




### Enterprise Survey 

```{r}
burkina_formal <- foreign::read.dta("Burkina Faso-2009--full data-.dta")
capeverde_formal <- foreign::read.dta("Cape Verde-2009-Indicator-full data-.dta")

# Burkina Faso: 

burkina_formal$country <- "Burkina Faso"
burkina_formal$formality <- 1


burkina_formal <- burkina_formal %>%
  select(country, formality, b3b, afb7a, b7, afb4a, b5, l1, d2, b3e, 
         k6, k8, k9, k13, k16, k17, k30)

colnames(burkina_formal)[-c(1,2)] <- c("female_owner", "edu_level", "experience", "nationality", 
                                        "yrs_operation", "size", "sales", "reluctant", 
                                        "bank_account", "loan", "source_loan", "collateral", "loan_application",
                                        "reason_no_app", "obstacle_finance") 

burkina_formal[burkina_formal == "don\x92t know "] <- NA
burkina_formal[burkina_formal == "don't know"] <- NA
burkina_formal[burkina_formal == "do not know"] <- NA
burkina_formal$nationality <- droplevels(burkina_formal$nationality)
levels(burkina_formal$nationality) <- c(1, 0, 0, 0, 0)

# dividing sales by 12 to get montly sales 
burkina_formal$sales <- burkina_formal$sales/12
burkina_formal$sales[burkina_formal$sales == -8] <- NA
burkina_formal$sales[burkina_formal$sales == -9] <- NA

# Cape Verde

capeverde_formal$country <- "Cape Verde"
capeverde_formal$formality <- 1


capeverde_formal <- capeverde_formal %>%
  select(country, formality, b3b, AFb7a, b7, AFb4a, b5, l1, d2, b3e, 
         k6, k8, k9, k13, k16, k17, k30)

colnames(capeverde_formal)[-c(1,2)] <- c("female_owner", "edu_level", "experience", "nationality", 
                                        "yrs_operation", "size", "sales", "reluctant", 
                                        "bank_account", "loan", "source_loan", "collateral", "loan_application",
                                        "reason_no_app", "obstacle_finance") 

capeverde_formal[capeverde_formal == "don\x92t know "] <- NA
capeverde_formal[capeverde_formal == "don't know"] <- NA
capeverde_formal[capeverde_formal == "do not know"] <- NA
capeverde_formal$nationality <- droplevels(capeverde_formal$nationality)
levels(capeverde_formal$nationality) <- c(1, 0, 0, 0, 0)

# dividing sales by 12 to get montly sales 
capeverde_formal$sales <- capeverde_formal$sales/12
capeverde_formal$sales[capeverde_formal$sales == -8] <- NA
capeverde_formal$sales[capeverde_formal$sales == -9] <- NA
```

### Binding Datasets:

```{r echo=FALSE, warning=FALSE}
regression2 <- rbind(capeverde_informal, capeverde_formal, burkina_informal, burkina_formal)

regression2[regression2 == "don\x92t know "] <- NA
regression2[regression2 == "don't know"] <- NA
regression2[regression2 == "do not know"] <- NA
regression2[regression2 == "don't know (spontaneous)               "] <- NA
regression2[regression2 == "don't know (spontaneous)"] <- NA
regression2[regression2 == "don't know (spontaneous)        "] <- NA

# gender variable  as dichotomous (female = 1)
regression2$female_owner <- droplevels(regression2$female_owner)
levels(regression2$female_owner) <- c(1, 0, 0, 1, 0)

# education level 
regression2$edu_level <- droplevels(regression2$edu_level)
levels(regression2$edu_level) 
levels(regression2$edu_level) <- c(1, 2, 3, 4, 5, 5, 6, 1, 2, 3, 4, 5, 6)

# years in operation

regression2$yrs_operation <- 2009 - regression2$yrs_operation

# being 'reluctant entrepreneur'
regression2$reluctant[regression2$reluctant == "don\x92t know"] <- NA
regression2$reluctant[regression2$reluctant == "other (spontaneous)                   "] <- NA
regression2$reluctant <- droplevels(regression2$reluctant)
levels(regression2$reluctant) 
levels(regression2$reluctant) <- c(0, 1, 1, 0, 1)

# bank account, separate account, loan, collateral, loan application

regression2$bank_account <-  droplevels(regression2$bank_account)
regression2$loan <- droplevels(regression2$loan)
regression2$collateral <- droplevels(regression2$collateral)
regression2$loan_application <- droplevels(regression2$loan_application)

levels(regression2$bank_account) <- c(1, 0, 0, 1, 0)
levels(regression2$loan) <- c(1, 0, 0, 1, 0)
levels(regression2$collateral) <- c(1, 0, 0, 1, 0)
levels(regression2$loan_application) <- c(1, 0, 0, 1, 0)

# sales:

regression2$sales[regression2$sales == -8] <- NA
regression2$sales[regression2$sales == -9] <- NA

# sales in $US (exchange rate in 2009)
regression2$sales[regression2$country == "Cape Verde"] <- regression2$sales[regression2$country == "Cape Verde"] * 0.013 
regression2$sales[regression2$country == "Burkina Faso"] <- regression2$sales[regression2$country == "Burkina Faso"] * 0.0022

# transforming finance as an obstacle into a dichotomous variable:
regression2$obstacle_finance <- as.factor(regression2$obstacle_finance)
regression2$obstacle_finance[regression2$obstacle_finance == "does not apply"] <- NA
regression2$obstacle_finance <- droplevels(regression2$obstacle_finance)
regression2$obstacle_finance5 <- regression2$obstacle_finance
levels(regression2$obstacle_finance) <- c(1, 1, 0, 0, 1, 1, 0, 0, 1, 1)
levels(regression2$obstacle_finance5) <- c(4, 4, 2, 2, 3, 3, 1, 1, 5, 5)


```

```{r}
regression <- rbind(regression, regression2)
regression$sales <- round(regression$sales)
```


```{r eval=FALSE, include=FALSE}
# selecting variables Peru 

peru_informal$nationality <- NA
peru_informal$reluctant <- NA
peru_informal$size <- peru_informal$l1a + peru_informal$l1b
peru_informal <- peru_informal %>%
  select(country, formality, b3, b21, b11, nationality, b12, size, d4, reluctant, 
         k10, k12, k13, k16, k17, k18, k30)


colnames(peru_informal)[-c(1,2)] <- c("female_owner", "edu_level", "experience", "nationality", 
                                        "yrs_operation", "size", "sales", "reluctant", 
                                        "bank_account", "loan", "source_loan", "collateral", "loan_application",
                                        "reason_no_app", "obstacle_finance") 

# Myanmar 

myanmar_informal$nationality <- NA
myanmar_informal$reluctant <- NA
myanmar_informal$size <- myanmar_informal$L1a + myanmar_informal$L1b

myanmar_informal <- myanmar_informal %>%
  select(country, formality, b3, b21, b11, nationality, b12, size, d4, reluctant, 
         k10, k12, k13, k16, k17, k18, k30)

colnames(myanmar_informal)[-c(1,2)] <- c("female_owner", "edu_level", "experience", "nationality", 
                                        "yrs_operation", "size", "sales", "reluctant", 
                                        "bank_account", "loan", "source_loan", "collateral", "loan_application",
                                        "reason_no_app", "obstacle_finance") 

informal <- rbin
```

### Formal Datasets Cleaning 

```{r eval=FALSE, include=FALSE}
peru_formal <- foreign::read.dta("Peru-2010-fulldata-.dta")
myanmar_formal <- foreign::read.dta("Myanmar-2014-fulldata.dta")

# **come back once access to online codebook** 

# Peru: 

peru_formal$country <- "Burkina Faso"
peru_formal$formality <- 1


peru_formal <- burkina_formal %>%
  select(country, formality)

colnames(peru_formal)[-c(1,2)] <- c("female_owner", "edu_level", "experience", "nationality", 
                                        "yrs_operation", "size", "sales", "reluctant", 
                                        "bank_account", "loan", "source_loan", "collateral", "loan_application",
                                        "reason_no_app", "obstacle_finance") 

peru_formal[peru_formal == "don\x92t know "] <- NA
peru_formal[peru_formal == "don't know"] <- NA
peru_formal[peru_formal == "do not know"] <- NA
peru_formal$nationality <- droplevels(peru_formal$nationality)
levels(peru_formal$nationality) <- c(1, 0, 0, 0, 0)

# dividing sales by 12 to get montly sales 
peru_formal$sales <- peru_formal$sales/12
peru_formal$sales[peru_formal$sales == -8] <- NA
burkina_formal$sales[peru_formal$sales == -9] <- NA

# Myanmar

myanmar_formal$country <- "Cape Verde"
myanmar_formal$formality <- 1


myanmar_formal <- myanmar_formal %>%
  select(country, formality, )

colnames(myanmar_formal)[-c(1,2)] <- c("female_owner", "edu_level", "experience", "nationality", 
                                        "yrs_operation", "size", "sales", "reluctant", 
                                        "bank_account", "loan", "source_loan", "collateral", "loan_application",
                                        "reason_no_app", "obstacle_finance") 

myanmar_formal[myanmar_formal == "don\x92t know "] <- NA
myanmar_formal[myanmar_formal == "don't know"] <- NA
myanmar_formal[myanmar_formal == "do not know"] <- NA
myanmar_formal$nationality <- droplevels(myanmar_formal$nationality)
levels(myanmar_formal$nationality) <- c(1, 0, 0, 0, 0)

# dividing sales by 12 to get montly sales 
myanmar_formal$sales <- myanmar_formal$sales/12
myanmar_formal$sales[myanmar_formal$sales == -8] <- NA
myanmar_formal$sales[myanmar_formal$sales == -9] <- NA
```


```{r}
# turning factors into numeric variables 
regression$bank_account <- as.numeric(as.character(regression$bank_account))
regression$edu_level <- as.numeric(as.character(regression$edu_level))
regression$experience <- as.numeric(as.character(regression$experience))
regression$edu_level <- as.numeric(as.character(regression$edu_level))
regression$female_owner <- as.numeric(as.character(regression$female_owner))
regression$reluctant <- as.numeric(as.character(regression$reluctant))
regression$obstacle_finance <- as.numeric(as.character(regression$obstacle_finance))
regression$obstacle_finance5 <- as.numeric(as.character(regression$obstacle_finance5))
```


## Linear Regression Models:

#### Simple Linear Model without Controls: 
```{r}

lm(bank_account ~ formality, data = regression) %>% summary()

```

#### Simple Linear Models with Fixed Effects: 
```{r}

lm(bank_account ~ formality + factor(country) - 1, data = regression) %>% summary()

```

#### Linear Model with Controls:

```{r}
lm(bank_account ~ formality + female_owner + size + sales + edu_level +
     experience + reluctant + yrs_operation, data = regression) %>% summary()
```

#### Linear Model with Controls and (Country) Fixed Effects: 

```{r}
lm(bank_account ~ formality + female_owner + size + sales + edu_level +
     experience + reluctant + yrs_operation + factor(country) - 1, data = regression) %>% summary()

# logit model
glm(bank_account ~ formality, family = binomial(link = "logit"), data = regression) %>% summary()
# need to expand logit model (+ interpreation log of odds ratio)

```

### Test for Multicollinearity Explanatory Variables:

```{r warning=FALSE}
# visualizing correlation between explanatory variables
X <- regression[, c(2,3,4,5,7,8,9,10)]

ggpairs(X)

# Farrar – Glauber Test 
mctest::imcdiag(X, regression$bank_account)
```

Collinearity was not detected among explanatory variables by the Farrar – Glauber Test. 

## Adding Country Level Control Variables: 

###  GDP per capita PPP in 2009 

source: World Bank Data 
https://data.worldbank.org/indicator/NY.GDP.PCAP.PP.CD?end=2015&start=2009


```{r}
# burkina faso
regression$gdp_cap <- 1347.6

# cabo verde 
regression$gdp_cap[regression$country == "Cape Verde"] <- 5620.5

# ivory coast 
regression$gdp_cap[regression$country == "Ivory Coast"] <- 2612.1

# madagascar
regression$gdp_cap[regression$country == "Madagascar"] <- 1375.6

# mauritius
regression$gdp_cap[regression$country == "Mauritius"] <- 14815.8

```

### Domestic Credit to Private Sector(as % of GDP) in 2009 

source: World Bank Data 
https://data.worldbank.org/indicator/FS.AST.PRVT.GD.ZS?end=2017&start=2009

```{r}
# burkina faso 
regression$credit_gdp <- 16.5

# cabo verde 
regression$credit_gdp[regression$country == "Cape Verde"] <- 58.0

# ivory coast 
regression$credit_gdp[regression$country == "Ivory Coast"] <- 15.7

# madagascar
regression$credit_gdp[regression$country == "Madagascar"] <- 11.4

# mauritius
regression$credit_gdp[regression$country == "Mauritius"] <- 80.1
```

### Depth of credit information index (0 = low to 8 = high) in 2013 (no data for 2009)

Source: World Bank Data 
https://data.worldbank.org/indicator/IC.CRD.INFO.XQ?view=chart

```{r}
# burkina faso 
regression$depth_credit <- 0

# cabo verde 
regression$depth_credit[regression$country == "Cape Verde"] <- 6

# ivory coast 
regression$depth_credit[regression$country == "Ivory Coast"] <- 0

# madagascar
regression$depth_credit[regression$country == "Madagascar"] <- 0

# mauritius
regression$depth_credit[regression$country == "Mauritius"] <- 7
```

### Strength of legal rights index (0 = weak to 12 = strong) in 2013 (no data for 2009)

Source: World Bank data
https://data.worldbank.org/indicator/IC.LGL.CRED.XQ?end=2017&start=2013
```{r}
# burkina faso 
regression$legal_rights <- 6

# cabo verde 
regression$legal_rights[regression$country == "Cape Verde"] <- 2

# ivory coast 
regression$legal_rights[regression$country == "Ivory Coast"] <- 6

# madagascar
regression$legal_rights[regression$country == "Madagascar"] <- 1

# mauritius
regression$legal_rights[regression$country == "Mauritius"] <- 6
```

## Cleaning loan/loan application variable: (2nd dependent variable)
```{r}
levels(regression$loan_application)
regression$loan_application <- as.numeric(as.character(regression$loan_application))
regression$loan <- as.numeric(as.character(regression$loan))

regression$y_loan <- regression$loan + regression$loan_application
regression$y_loan <- as.factor(regression$y_loan)
levels(regression$y_loan) <- c(0, 1, 1)

levels(regression$reason_no_app)[c(1,15,20, 23)] <- "don't know"
levels(regression$reason_no_app)[c(7, 18, 27)] <- "other"
levels(regression$reason_no_app)[c(3, 9, 16, 18, 21)] <- "application procedures are complex"
levels(regression$reason_no_app)[c(5, 10, 19)] <- "collateral requirements are too high"
levels(regression$reason_no_app)[c(6,11,14,19)] <- "did not think it would be approved because i am not registered"
levels(regression$reason_no_app)[c(9, 15)] <- "interest rates are not favorable"
levels(regression$reason_no_app)[c(10, 13, 15)] <- "size of loan and maturity are insufficient"
levels(regression$reason_no_app)[c(2, 8, 12, 13)] <- "no need for a loan"

# dataset will be used to implement regression when the dependent variable is: business has/applied for a loan 
# I'm excluding firms that explicitly stated they did not apply because they don't need a loan 
# the dependent variable will therefore be a better proxy of financial inclusion/constraints 

regression_y <- regression %>% filter(!(y_loan == 0 & reason_no_app == "no need for a loan"))
levels(regression_y$reason_no_app) 
regression_y$reason_no_app <- droplevels(regression_y$reason_no_app)

# include test defensive coding to check if new dataset has been properly subsetted
regression_y[regression_y$y_loan == 0 & regression_y$reason_no_app == "no need for a loan"]

```

### Regression Tables: 

#### Bank Account as Dependent Variable
```{r, echo = TRUE, warning = FALSE, message = FALSE, results='asis'}
lm1 <- lm(bank_account ~ formality, data = regression) 
lm2 <- lm(bank_account ~ formality + female_owner + size + sales + edu_level +
            experience + reluctant + yrs_operation, data = regression) 
lm3 <- lm(bank_account ~ formality + factor(country) - 1, data = regression)
lm4 <- lm(bank_account ~ formality + female_owner + size + sales + edu_level +
            experience + reluctant + yrs_operation + factor(country) - 1, data = regression)
lm5 <- lm(bank_account ~ formality + female_owner + size + sales + edu_level +
            experience + reluctant + yrs_operation + gdp_cap, data = regression)
lm6 <- lm(bank_account ~ formality + female_owner + size + sales + edu_level +
            experience + reluctant + yrs_operation + credit_gdp, data = regression)
lm7 <- lm(bank_account ~ formality + female_owner + size + sales + edu_level +
            experience + reluctant + yrs_operation + depth_credit, data = regression)
lm8 <- lm(bank_account ~ formality + female_owner + size + sales + edu_level +
            experience + reluctant + yrs_operation + legal_rights, data = regression)

stargazer::stargazer(lm1, lm2, lm3, lm4, lm5, lm6, lm7, lm8,
                     type = "html", dep.var.labels = c("Business Has a Bank Account ( = 1)"), 
                     covariate.labels = c("Formality", "Female Owner (=1)", "Size (number of employees)", "Sales (in $US)",
                                          "Owner's Education Level", "Owner's Experience (years)", 
                                          "Owner is a Reluctant Entrepreneur", "Firm Age", 
                                          "GDP/capita PPP", "Credit to Private Sector (% to GDP", 
                                          "Depth of Credit Information Index", "Strength of Legal Rights Index"), 
                     add.lines = list(c("Country Fixed Effects", "No", "No", "Yes", "Yes", "No", "No", "No", "No"),
                                      c("Firm Level Controls", "No", "Yes", "No", "Yes", "Yes", "Yes", "Yes", "Yes"), 
                                      c("Country Level Controls", "No","No", "No", "No", "Yes", "Yes","Yes", "Yes")),
                     omit = "country")
```




#### Loan/Loan Application as Dependent Variable:



```{r, echo = TRUE, warning = FALSE, message = FALSE, results='asis'}
regression_y$y_loan <- as.numeric(as.character(regression_y$y_loan))

lm9 <- lm(y_loan ~ formality, data = regression_y) 
lm10 <- lm(y_loan ~ formality + female_owner + size + sales + edu_level +
            experience + reluctant + yrs_operation, data = regression_y) 
lm11 <- lm(y_loan ~ formality + factor(country) - 1, data = regression_y)
lm12 <- lm(y_loan ~ formality + female_owner + size + sales + edu_level +
            experience + reluctant + yrs_operation + factor(country) - 1, data = regression_y)
lm13 <- lm(y_loan ~ formality + female_owner + size + sales + edu_level +
            experience + reluctant + yrs_operation + gdp_cap, data = regression_y)
lm14 <- lm(y_loan ~ formality + female_owner + size + sales + edu_level +
            experience + reluctant + yrs_operation + credit_gdp, data = regression_y)
lm15 <- lm(y_loan ~ formality + female_owner + size + sales + edu_level +
            experience + reluctant + yrs_operation + depth_credit, data = regression_y)
lm16 <- lm(y_loan ~ formality + female_owner + size + sales + edu_level +
            experience + reluctant + yrs_operation + legal_rights, data = regression_y)

stargazer::stargazer(lm9, lm10, lm11, lm12, lm13, lm14, lm15, lm16,
                     type = "html", dep.var.labels = c("Business Has /(Applied for) a Loan ( = 1)"), 
                     covariate.labels = c("Formality", "Female Owner (=1)", "Size (number of employees)", "Sales (in $US)",
                                          "Owner's Education Level", "Owner's Experience (years)", 
                                          "Owner is a Reluctant Entrepreneur", "Firm Age", 
                                          "GDP/capita PPP", "Credit to Private Sector (% to GDP", 
                                          "Depth of Credit Information Index", "Strength of Legal Rights Index"), 
                     add.lines = list(c("Country Fixed Effects", "No", "No", "Yes", "Yes", "No", "No", "No", "No"),
                                      c("Firm Level Controls", "No", "Yes", "No", "Yes", "Yes", "Yes", "Yes", "Yes"), 
                                      c("Country Level Controls", "No","No", "No", "No", "Yes", "Yes","Yes", "Yes")),
                     omit = "country")



```


## GLM: Logistic Regression Models:




